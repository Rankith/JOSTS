{% block content %}
{% load staticfiles %}

<div class="text-center detail-background rounded-top">
    <div class="row" onclick="SaveNote(); CloseElement()">
        <div class="col">
            <div style="height:220px" class="image-background rounded position-relative">
               <div class="detail-top-left text-white">{{lang_elements.named}}</div>
                <div class="detail-top-right"><img class="img-fluid detail-sym" src="{% static 'app/images/wag/sym/'%}{{ lang_elements.element.image_url}}.svg"/></div>
                <div class="additional-info" id="divAdditionalInfo">
                    {{lang_elements.additional_info}}
                </div>
                <div id="divYourNote" class="your-note">
			        <label class="text-white mb-0">Your Note:</label><br/>
                    <textarea id="txtUserNotes" name="txtUserNotes" rows="3" class="w-100">{{user_note}}</textarea>
                </div>
                <div class="row h-100 justify-content-center align-items-center">
                    <div class="col-12 text-white position-relative">
                        <img class="img-fluid detail-image" src="{% static 'app/images/wag/elements/'%}{{ lang_elements.element.image_url}}.svg"/>
                    </div>
                    <div class="col-12 pb-1 text-white" style="margin-top:-1rem">
                        {{ lang_elements.text}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col"><div class="text-center text-white">{{lang_elements.element.id_number}}</div></div>
        <div class="col"><div class="text-center text-white">{{lang_elements.element.letter_value}} = {{lang_elements.element.value}}</div></div>
       
        <div class="col text-white">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="chkAdditionalInfo" style="margin-top:.45rem">
                <label for="chkAdditionalInfo" class="form-check-label">INFO&nbsp;</label>
            </div>
        </div>
         <div class="col text-white">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="chkYourNote" style="margin-top:.45rem">
                <label for="chkYourNote" class="form-check-label">NOTES</label>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    //store checkboxes in ls and load as needed
    if (localStorage.additional_info) {
        $('#chkAdditionalInfo').prop("checked", localStorage.additional_info == 1)
        $('#chkAdditionalInfo').prop("checked") ? $("#divAdditionalInfo").show() : $("#divAdditionalInfo").hide();
    }
    else
        $("#divAdditionalInfo").hide();
    $('#chkAdditionalInfo').change(function() {
        localStorage.additional_info = this.checked ? 1 : 0
        this.checked ? $("#divAdditionalInfo").show() : $("#divAdditionalInfo").hide();
    });
    if (localStorage.your_note) {
        $('#chkYourNote').prop("checked", localStorage.your_note == 1)
        $('#chkYourNote').prop("checked") ? $("#divYourNote").show() : $("#divYourNote").hide();
    }
    else
        $("#divYourNote").hide();
    $('#chkYourNote').change(function() {
        localStorage.your_note = this.checked ? 1 : 0
        this.checked ? $("#divYourNote").show() : $("#divYourNote").hide();
    });

    //stop the notes area from closing if you click in it.
    $("#txtUserNotes").click(function(e) {
        e.stopPropagation();
    });

    //save the notes when done typing
    var typingTimer;                //timer identifier
    var doneTypingInterval = 1000;  //time in ms (5 seconds)

    //on keyup, start the countdown
    $('#txtUserNotes').keyup(function(){
        clearTimeout(typingTimer);
        if ($('#txtUserNotes').val()) {
            typingTimer = setTimeout(SaveNote, doneTypingInterval);
        }
    });

    //user is "finished typing," do something
    function SaveNote () {
        var note = $('#txtUserNotes').val();

        $.ajax({
            url: '{% url "update_user_note" %}',
            data: {
                'note': note,
                'element': '{{lang_elements.element.id}}'
            },
            dataType: 'json',
            success: function (data) {
              if (data.is_taken) {
                alert("A user with this username already exists.");
              }
            }
      });
    }
</script>

{% endblock %}

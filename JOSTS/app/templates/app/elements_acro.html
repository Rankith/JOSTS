{% extends "app/layout.html" %}

{% block content %}
{% load staticfiles %}
<div class="wrapper-sidebar">
    <div id="divContentParent" class="position-relative">

        <div class="text-base col pr-0 pl-0 " id="divElementList" style="min-height:100%">
            <div id="divElementHolder" class="row" style="flex-wrap:nowrap">
                
            </div>
        </div>

    </div>
</div>
{% endblock %}
{% block scripts %}
  
    <script type="text/javascript">
    </script>
<script type="text/javascript">
    var OnElement = 0;
    var ElementSkeleton = '<div id="divElement[ElementNumber]" class="col-md-4 col-10 d-flex align-items-center justify-content-center" style="height:calc(100vh - 100px)"><button id = "btnNext" type = "button" class="btn btn-main pr-3 pl-3 search-button" onclick = "AddElement()" ><i class="fas fa-plus"></i></button ></div >';
    SetNextContainer();

    function AddElement() {
        $("#divElement" + OnElement).load("/element_search", LoadLastSelections);
    }
    function SetNextContainer() {
        OnElement++;
        $("#divElementHolder").append(ElementSkeleton.replace("[ElementNumber]", OnElement));
    }
    var Event = "";
    var ValueDisplay = "value";

    $('#txtSearch').keypress(function (e) {
        if (e.which == 13) {
            SearchClick();
            return false;    //<---- Add this line
        }
    });
    function ClearSearch() {
        $('#txtSearch').val("")
    }

    function SearchChangeEvent(el) {
        //console.log("SCE");
        if (!el.checked)
            $(el).prop('checked', true);
        else {
            localStorage.setItem(el.id, el.checked ? 1 : 0);
            $('.check-search-event').not(el).prop('checked', false);
            $('.check-search-event').not(el).each(function (i) {
                localStorage.setItem(this.id, 0);
            });
            ShowHideSearches();
            CreateSearchParams();
            //Event = $(el).val();
        }
    }

    function SearchChangeType(el) {
        //console.log("SCE");
        if (!el.checked)
            $(el).prop('checked', true);
        else {
            localStorage.setItem(el.id, el.checked ? 1 : 0);
            $('.check-search-type').not(el).prop('checked', false);
            $('.check-search-type').not(el).each(function (i) {
                localStorage.setItem(this.id, 0);
            });
            ShowHideSearches();
            CreateSearchParams();
            //Event = $(el).val();
        }
    }

    function DisplayChange(el) {
        //console.log("DC");
        if (!el.checked)
            $(el).prop('checked', true);
        else {
            localStorage.setItem(el.id, el.checked ? 1 : 0);
            $('.check-search-display').not(el).prop('checked', false);
            $('.check-search-display').not(el).each(function (i) {
                localStorage.setItem(this.id, 0);
            });
            CreateSearchParams();
            //Event = $(el).val();
        }
    }

    function ShowHideSearches() {
        if (search_type != "rule") {
            ev = $('.check-search-event:checked').val();
            $('.check-search').not('.check-search-event').not('.check-search-show').not('.search-' + ev).parent().hide();
            $('.check-search.search-' + ev).parent().show();
        }
        /*if (ev == "V") {
            $('#Values').hide();
            $('#VaultValues').hide();*/

    }

    function SearchClick() {
        CreateSearchParams();
    }

    function SearchChange(el) {
        //console.log("SC");
        localStorage.setItem(el.id, el.checked ? 1 : 0);
        //CreateSearchParams();
    }

    function GoSearch() {
        CreateSearchParams();
    }
    function CreateSearchParams() {
        //console.log("CSP");
        var strValues = "";
        Event = $('.check-search-event:checkbox:checked').val();

        $(".check-search:checkbox:checked").each(function (i) {
            if ($(this).parent().is(":visible"))
                strValues += $(this).attr("data-search") + "=" + $(this).val() + "&";
            //console.log($(this).attr("data-search") + " : " + $(this).val());
        });

        //if ($("#txtSearch").val() != "")
        strValues = "search=" + $("#txtSearch").val() + "&" + strValues;
        console.log(strValues);

        $.get("/element_list/?" + strValues, function (data) {
            $("#divElement" + OnElement).empty();
            $("#divElement" + OnElement).append(data);
            SetNextContainer();
        });

        //$("#divElementList").empty();
        //$("#divElementList").load("/element_list/?" + strValues);
    }
    function SearchReset() {
        $(".check-search:checkbox:checked:not(.check-search-event)").each(function (i) {
            localStorage.setItem(this.id, 0);
            $(this).removeAttr('checked');

        });
        $("#txtSearch").val("");
        CreateSearchParams();
    }
    function LoadLastSelections() {
        //console.log("LLS");
        //console.log(localStorage);

        $(".check-search:checkbox").each(function (i) {
            console.log(this.id);
            console.log(localStorage.getItem(this.id));
            if (localStorage.getItem(this.id) == "1")
                $(this).prop('checked', true);
            else
                $(this).prop('checked', false);
        });
        if (search_type == "element" || type == "shorthand_trainer") {
            $(".check-search-type:checkbox").each(function (i) {
                if (localStorage.getItem(this.id) == "1")
                    $(this).prop('checked', true);
                else
                    $(this).prop('checked', false);
            });
            if ($('.check-search-type:checked').val() == undefined) {
                $("#chkAcrBAL").prop('checked', true);
                localStorage.setItem('chkAcrBAL', 1);
            }
        }
        console.log($(".check-search-event:checkbox:checked").length);
        if ($(".check-search-event:checkbox:checked").length == 0 && $(".check-search-event:checkbox").length > 0)
            $(".check-search-event:checkbox")[0].click();
        else {
            ShowHideSearches();
        }
    }

</script>
{% endblock %}
